Militants were carrying an Islamic State flag when they killed more than 300 people in an attack on a mosque in Egypt's North Sinai, authorities have said. The gunmen, some wearing masks and military-style uniforms, surrounded the mosque blocking windows and a doorway and opened fire inside with automatic rifles, the public prosecutor's office said. Witnesses say gunmen set off a bomb at the end of Friday prayers at the Al Rawdah mosque in Bir al-Abed, west of El-Arish city, and then opened fire as worshippers tried to flee, shooting at ambulances and setting fire to cars to block roads. Images on state media showed bloodied victims and bodies covered in blankets inside the mosque. "They numbered between 25 and 30, carrying the Daesh flag and took up positions in front of the mosque door and its 12 windows with automatic rifles,"the public prosecutor's office said in a statement on Saturday. Daesh is the Arabic term for IS, also known as ISIS or ISIL. The attack also left 128 people injured, the MENA state news agency reported. No group has claimed responsibility, but Egyptian forces are battling a stubborn Islamic State affiliate in the region, one of the surviving branches of the militant group after it suffered defeats by U.S.-backed forces in Iraq and Syria. Egypt's military said they had carried out air strikes and raids overnight against militants held responsible for the killings, the bloodiest attack in Egypt's modern history.